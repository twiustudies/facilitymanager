{% extends "base.html" %}
{% block content %}
<h1>Wartungsberichte</h1>

<!-- Filteroption für überfällige Wartungen -->
<label for="overdueFilter">
    <input type="checkbox" id="overdueFilter" onclick="filterOverdue()"> Nur überfällige Wartungen anzeigen
</label>

<!-- Kategorie-Filter -->
<label for="categoryFilter">Kategorie:</label>
<select id="categoryFilter" onchange="filterCategory()">
    <option value="">Alle Kategorien</option>
    <option value="Electrical">⚡ Elektrisch</option>
    <option value="Sanitary">🚰 Sanitär</option>
    <option value="Building Maintenance">🏗️ Gebäudewartung</option>
</select>

<!-- Suchfeld für Live-Suche -->
<input type="text" id="searchInput" placeholder="Suche nach Gebäude, Wartungstyp oder Datum..." onkeyup="searchMaintenance()">

<!-- Druck-Button -->
<button onclick="window.print()" class="print-button">📄 Drucken</button>

<!-- Wartungsberichtstabelle -->
<table id="maintenanceReport">
  <thead>
    <tr>
      <th>Gebäude</th>
      <th>Datum</th>
      <th>Auftrag</th>
      <th>Kategorie</th>
    </tr>
  </thead>
  <tbody id="maintenanceList">
    {% for plan in maintenance_plans %}
    <tr class="maintenance-item 
        {% if plan.overdue %}overdue{% elif plan.recently_completed %}completed{% endif %}" data-category="{{ plan.category }}">
      <td class="maintenance-data">{{ plan.building_id }}</td>
      <td class="maintenance-data">{{ plan.date }}</td>
      <td class="maintenance-data">{{ plan.description }}</td>
      <td class="maintenance-category">
        {% if plan.category == "Electrical" %} ⚡ Elektrisch
        {% elif plan.category == "Sanitary" %} 🚰 Sanitär
        {% elif plan.category == "Building Maintenance" %} 🏗️ Gebäudewartung
        {% else %} Andere {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Nachricht, wenn keine Ergebnisse gefunden wurden -->
<p id="noResultsMessage" style="display: none;">Keine Wartungseinträge gefunden.</p>

<script>
function searchMaintenance() {
    let input = document.getElementById("searchInput").value.toLowerCase();
    let items = document.querySelectorAll(".maintenance-item");
    let found = false;

    items.forEach(item => {
        let text = item.textContent.toLowerCase();
        if (text.includes(input)) {
            item.style.display = "table-row";
            found = true;
        } else {
            item.style.display = "none";
        }
    });

    document.getElementById("noResultsMessage").style.display = found ? "none" : "block";
}

// Filter für überfällige Wartungen
function filterOverdue() {
    let checkbox = document.getElementById("overdueFilter");
    let items = document.querySelectorAll(".maintenance-item");

    items.forEach(item => {
        if (checkbox.checked) {
            if (!item.classList.contains("overdue")) {
                item.style.display = "none";
            }
        } else {
            item.style.display = "table-row";
        }
    });
}

// Filter für Kategorien
function filterCategory() {
    let category = document.getElementById("categoryFilter").value;
    let items = document.querySelectorAll(".maintenance-item");

    items.forEach(item => {
        if (category === "" || item.getAttribute("data-category") === category) {
            item.style.display = "table-row";
        } else {
            item.style.display = "none";
        }
    });
}
</script>

<style>
  /* Farben für verschiedene Wartungskategorien */
  .Electrical {
    background-color: #e0f7fa !important;
  }

  .Sanitary {
    background-color: #e8f5e9 !important;
  }

  .Building Maintenance {
    background-color: #fff3e0 !important;
  }

  /* Farben für überfällige und abgeschlossene Wartungen */
  .overdue {
    background-color: #ffcccc !important;
    border-left: 5px solid #cc0000;
  }

  .completed {
    background-color: #ccffcc !important;
    border-left: 5px solid #008000;
  }

  /* Druckfreundliches Design */
  @media print {
    body {
      font-family: Arial, sans-serif;
      background: white;
      color: black;
    }
    .print-button, #searchInput, #overdueFilter, #categoryFilter {
      display: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid black;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f4f4f4;
    }
  }
</style>

{% endblock %}
