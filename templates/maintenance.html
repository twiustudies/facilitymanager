{% extends "base.html" %}
{% block content %}
<h1>Wartungsberichte</h1>

<!-- Filteroption f√ºr √ºberf√§llige Wartungen -->
<label for="overdueFilter">
    <input type="checkbox" id="overdueFilter" onclick="filterOverdue()"> Nur √ºberf√§llige Wartungen anzeigen
</label>

<!-- Suchfeld f√ºr Live-Suche -->
<input type="text" id="searchInput" placeholder="Suche nach Geb√§ude, Wartungstyp oder Datum..." onkeyup="searchMaintenance()">

<!-- Druck-Button -->
<button onclick="window.print()" class="print-button">üìÑ Drucken</button>

<!-- Wartungsberichtstabelle -->
<table id="maintenanceReport">
  <thead>
    <tr>
      <th>Geb√§ude</th>
      <th>Datum</th>
      <th>Auftrag</th>
    </tr>
  </thead>
  <tbody id="maintenanceList">
    {% for plan in maintenance_plans %}
    <tr class="maintenance-item 
        {% if plan.overdue %}overdue{% elif plan.recently_completed %}completed{% endif %}">
      <td class="maintenance-data">{{ plan.building_id }}</td>
      <td class="maintenance-data">{{ plan.date }}</td>
      <td class="maintenance-data">{{ plan.description }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Nachricht, wenn keine Ergebnisse gefunden wurden -->
<p id="noResultsMessage" style="display: none;">Keine Wartungseintr√§ge gefunden.</p>

<script>
function searchMaintenance() {
    let input = document.getElementById("searchInput").value.toLowerCase();
    let items = document.querySelectorAll(".maintenance-item");
    let found = false;

    items.forEach(item => {
        let text = item.textContent.toLowerCase();
        if (text.includes(input)) {
            item.style.display = "table-row";
            found = true;
        } else {
            item.style.display = "none";
        }
    });

    document.getElementById("noResultsMessage").style.display = found ? "none" : "block";
}

// Filter f√ºr √ºberf√§llige Wartungen
function filterOverdue() {
    let checkbox = document.getElementById("overdueFilter");
    let items = document.querySelectorAll(".maintenance-item");

    items.forEach(item => {
        if (checkbox.checked) {
            if (!item.classList.contains("overdue")) {
                item.style.display = "none";
            }
        } else {
            item.style.display = "table-row";
        }
    });
}
</script>

<style>
  /* Farben f√ºr verschiedene Wartungszust√§nde */
  .overdue {
    background-color: #ffcccc !important;
    border-left: 5px solid #cc0000;
  }

  .completed {
    background-color: #ccffcc !important;
    border-left: 5px solid #008000;
  }

  /* Druckfreundliches Design */
  @media print {
    body {
      font-family: Arial, sans-serif;
      background: white;
      color: black;
    }
    .print-button, #searchInput, #overdueFilter {
      display: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid black;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f4f4f4;
    }
  }

  /* Standard Ansicht */
  .print-button {
    padding: 10px;
    background: #007bff;
    color: white;
    border: none;
    cursor: pointer;
    margin-bottom: 10px;
  }

  .print-button:hover {
    background: #0056b3;
  }

  #searchInput {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    font-size: 16px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }

  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
  }

  th {
    background-color: #f4f4f4;
  }
</style>

{% endblock %}
